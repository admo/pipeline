<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Open Segments</title>
<link rel="stylesheet" href="http://www.boost.org/doc/libs/1_55_0/doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;Boost.Pipeline 1">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;Boost.Pipeline 1">
<link rel="prev" href="transformations.html" title="Transformations">
<link rel="next" href="scheduling.html" title="Scheduling">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="transformations.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="scheduling.html"><img src="../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="pipeline.open_segments"></a><a class="link" href="open_segments.html" title="Open Segments">Open Segments</a>
</h2></div></div></div>
<p>
      Sometimes it's not feasible to assemble a pipeline in one go. One might want
      to build up smaller chunks and connect them dynamically. It's possible to create
      incomplete plans (i.e: <span class="emphasis"><em>segments</em></span>) using <code class="computeroutput"><a class="link" href="../boost/pipeline/make_idp21021856.html" title="Function template make">make()</a></code>:
    </p>
<pre class="programlisting"><span class="keyword">auto</span> <span class="identifier">s2</span> <span class="special">=</span> <span class="identifier">ppl</span><span class="special">::</span><span class="identifier">make</span><span class="special">(</span><span class="identifier">length</span><span class="special">)</span> <span class="special">|</span> <span class="identifier">output</span><span class="special">;</span>
<span class="keyword">auto</span> <span class="identifier">s1</span> <span class="special">=</span> <span class="identifier">ppl</span><span class="special">::</span><span class="identifier">from</span><span class="special">(</span><span class="identifier">lines</span><span class="special">)</span> <span class="special">|</span> <span class="identifier">trim</span><span class="special">;</span>
<span class="keyword">auto</span> <span class="identifier">s</span>  <span class="special">=</span> <span class="identifier">s1</span> <span class="special">|</span> <span class="identifier">s2</span><span class="special">;</span>
</pre>
<p>
      Segments created by <code class="computeroutput"><span class="identifier">make</span></code>, such
      as <code class="computeroutput"><span class="identifier">s2</span></code> in the example are non-terminated
      segments (<a href="https://github.com/erenon/pipeline/blob/master/include/boost/pipeline/detail/open_segment.hpp" target="_top">include/boost/pipeline/detail/open_segment.hpp</a>)
      and not much of use on their own. To run them, they must be connected to an
      appropriate right-terminated but left-open segment (e.g: <code class="computeroutput"><span class="identifier">s1</span></code>).
    </p>
<h2>
<a name="pipeline.open_segments.h0"></a>
      <span class="phrase"><a name="pipeline.open_segments.type_erasure"></a></span><a class="link" href="open_segments.html#pipeline.open_segments.type_erasure">Type
      erasure</a>
    </h2>
<p>
      It might be necessary to take segments or plans as arguments, therefore a type
      is required. We always used the <code class="computeroutput"><span class="keyword">auto</span></code>
      keyword so far when it came to segments, because the actual type is rather
      complex and internal to the library. However, type erased handles are provided
      to be able to refer to them. <code class="computeroutput">segment&lt;Input,
      Ouput&gt;</code> can refer to any segment or plan which takes <code class="computeroutput"><span class="identifier">Input</span></code>s as input and produces <code class="computeroutput"><span class="identifier">Output</span></code>s. The tag <code class="computeroutput"><span class="identifier">terminated</span></code>
      denotes a closed end. A complete pipeline can be referenced as <code class="computeroutput"><span class="identifier">segment</span><span class="special">&lt;</span><span class="identifier">terminated</span><span class="special">,</span> <span class="identifier">terminated</span><span class="special">&gt;</span></code>
      or just simply <code class="computeroutput"><span class="identifier">ppl</span><span class="special">::</span><span class="identifier">plan</span></code>:
    </p>
<pre class="programlisting"><span class="identifier">ppl</span><span class="special">::</span><span class="identifier">segment</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">size_t</span><span class="special">&gt;</span> <span class="identifier">s2</span> <span class="special">=</span> <span class="identifier">ppl</span><span class="special">::</span><span class="identifier">make</span><span class="special">(</span><span class="identifier">length</span><span class="special">);</span>
<span class="identifier">ppl</span><span class="special">::</span><span class="identifier">segment</span><span class="special">&lt;</span><span class="identifier">ppl</span><span class="special">::</span><span class="identifier">terminated</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span> <span class="identifier">s1</span> <span class="special">=</span> <span class="identifier">ppl</span><span class="special">::</span><span class="identifier">from</span><span class="special">(</span><span class="identifier">lines</span><span class="special">)</span> <span class="special">|</span> <span class="identifier">trim</span><span class="special">;</span>
<span class="identifier">ppl</span><span class="special">::</span><span class="identifier">segment</span><span class="special">&lt;</span><span class="identifier">ppl</span><span class="special">::</span><span class="identifier">terminated</span><span class="special">,</span> <span class="identifier">ppl</span><span class="special">::</span><span class="identifier">terminated</span><span class="special">&gt;</span> <span class="identifier">s</span> <span class="special">=</span> <span class="identifier">s1</span> <span class="special">|</span> <span class="identifier">s2</span> <span class="special">|</span> <span class="identifier">output</span><span class="special">;</span>
</pre>
<p>
      Thanks to the type erased handles, it's easy to create interfaces expecting
      segments or plans:
    </p>
<pre class="programlisting"><span class="keyword">void</span> <span class="identifier">execute_plan</span><span class="special">(</span><span class="identifier">ppl</span><span class="special">::</span><span class="identifier">plan</span><span class="special">&amp;</span> <span class="identifier">p</span><span class="special">)</span>
<span class="special">{</span>
  <span class="identifier">ppl</span><span class="special">::</span><span class="identifier">thread_pool</span> <span class="identifier">pool</span><span class="special">{</span><span class="number">1</span><span class="special">};</span>
  <span class="keyword">auto</span> <span class="identifier">exec</span> <span class="special">=</span> <span class="identifier">p</span><span class="special">.</span><span class="identifier">run</span><span class="special">(</span><span class="identifier">pool</span><span class="special">);</span>
  <span class="identifier">exec</span><span class="special">.</span><span class="identifier">wait</span><span class="special">();</span>
<span class="special">}</span>

<span class="identifier">ppl</span><span class="special">::</span><span class="identifier">segment</span><span class="special">&lt;</span><span class="identifier">ppl</span><span class="special">::</span><span class="identifier">terminated</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">size_t</span><span class="special">&gt;</span> <span class="identifier">append_length</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">ppl</span><span class="special">::</span><span class="identifier">segment</span><span class="special">&lt;</span><span class="identifier">ppl</span><span class="special">::</span><span class="identifier">terminated</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;&amp;</span> <span class="identifier">s1</span><span class="special">)</span>
<span class="special">{</span>
  <span class="keyword">return</span> <span class="identifier">s1</span> <span class="special">|</span> <span class="identifier">length</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      However, using these aliases does not come for free: it involves allocation
      of dynamic memory and indirection. It's recommended to use the <code class="computeroutput"><span class="keyword">auto</span></code> keyword instead wherever it's possible.
    </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2014 Benedek Thaler<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="transformations.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="scheduling.html"><img src="../images/next.png" alt="Next"></a>
</div>
</body>
</html>
