<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Transformations</title>
<link rel="stylesheet" href="http://www.boost.org/doc/libs/1_55_0/doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;Boost.Pipeline 1">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;Boost.Pipeline 1">
<link rel="prev" href="glossary.html" title="Glossary">
<link rel="next" href="open_segments.html" title="Open Segments">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="glossary.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="open_segments.html"><img src="../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="pipeline.transformations"></a><a class="link" href="transformations.html" title="Transformations">Transformations</a>
</h2></div></div></div>
<p>
      A transformation is a callable which receives one or more input items and produces
      one or more output items in turn. Depending on exactly how much items are read
      and produced on each call, transformations have different signatures:
    </p>
<pre class="programlisting"><span class="comment">// not exhaustive list of possible signatures</span>
<span class="identifier">Output</span> <span class="identifier">one_to_one</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">Input</span><span class="special">&amp;</span> <span class="identifier">input</span><span class="special">);</span>
<span class="identifier">R</span>      <span class="identifier">one_to_n</span>  <span class="special">(</span><span class="keyword">const</span> <span class="identifier">Input</span><span class="special">&amp;</span> <span class="identifier">input</span><span class="special">,</span>           <span class="identifier">queue_back</span><span class="special">&lt;</span><span class="identifier">Output</span><span class="special">&gt;&amp;</span> <span class="identifier">downstream</span><span class="special">);</span>
<span class="identifier">Output</span> <span class="identifier">n_to_one</span>  <span class="special">(</span><span class="identifier">queue_front</span><span class="special">&lt;</span><span class="identifier">Input</span><span class="special">&gt;&amp;</span> <span class="identifier">upstream</span><span class="special">);</span>
<span class="identifier">R</span>      <span class="identifier">n_to_m</span>    <span class="special">(</span><span class="identifier">queue_front</span><span class="special">&lt;</span><span class="identifier">Input</span><span class="special">&gt;&amp;</span> <span class="identifier">upstream</span><span class="special">,</span> <span class="identifier">queue_back</span><span class="special">&lt;</span><span class="identifier">Output</span><span class="special">&gt;&amp;</span> <span class="identifier">downstream</span><span class="special">);</span>
</pre>
<p>
      Type legend:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
          <span class="bold"><strong>Input</strong></span>: type of input items
        </li>
<li class="listitem">
          <span class="bold"><strong>Output</strong></span>: type of output items
        </li>
<li class="listitem">
          <span class="bold"><strong>R</strong></span>: arbitrary return type
        </li>
</ul></div>
<p>
      Input items can be taken as <code class="computeroutput"><span class="keyword">const</span><span class="special">&amp;</span></code> (as above) or by value (if it's possible).
      Queue handles can be taken by value or by reference; a <code class="computeroutput"><span class="keyword">const</span><span class="special">&amp;</span></code> doesn't make much sense.
    </p>
<p>
      A transformation can be anything which is callable with any of the above arguments.
      This includes function pointers, function objects, functors, bind expressions
      and lambdas. Examples:
    </p>
<pre class="programlisting"><span class="identifier">std</span><span class="special">::</span><span class="identifier">size_t</span> <span class="identifier">length</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">input</span><span class="special">);</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">function</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">size_t</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;)&gt;</span> <span class="identifier">length_f</span><span class="special">(</span><span class="identifier">length</span><span class="special">);</span>
<span class="keyword">auto</span> <span class="identifier">inverse</span> <span class="special">=</span> <span class="special">[]</span> <span class="special">(</span><span class="keyword">int</span> <span class="identifier">input</span><span class="special">)</span> <span class="special">{</span> <span class="keyword">return</span> <span class="identifier">input</span> <span class="special">*</span> <span class="special">(-</span><span class="number">1</span><span class="special">);</span> <span class="special">};</span>
<span class="keyword">auto</span> <span class="identifier">add_5</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">bind</span><span class="special">(</span><span class="identifier">add</span><span class="special">,</span> <span class="number">5</span><span class="special">,</span> <span class="identifier">_1</span><span class="special">);</span>
</pre>
<p>
      Such transformations can be connected to appropriate segments using the <code class="computeroutput"><span class="special">|</span></code> operator. However, there are one restriction
      on bind expressions. Assume the following example:
    </p>
<pre class="programlisting"><span class="comment">// takes the square root of input if it's greater than `threshold`</span>
<span class="keyword">void</span> <span class="identifier">sqrt_if_greater</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">threshold</span><span class="special">,</span> <span class="identifier">queue_front</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;&amp;</span> <span class="identifier">upstream</span><span class="special">,</span> <span class="identifier">queue_back</span><span class="special">&lt;</span><span class="keyword">float</span><span class="special">&gt;&amp;</span> <span class="identifier">downstream</span><span class="special">);</span>

<span class="keyword">auto</span> <span class="identifier">sqrt_if_greater_than_5</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">bind</span><span class="special">(</span><span class="identifier">sqrt_if_greater</span><span class="special">,</span> <span class="number">5</span><span class="special">,</span> <span class="identifier">_1</span><span class="special">,</span> <span class="identifier">_2</span><span class="special">);</span>
</pre>
<p>
      This case, the library has no way to find out the valid argument list of the
      <code class="computeroutput"><span class="keyword">operator</span><span class="special">()</span></code>
      template the bind has; it can't guess the <code class="computeroutput"><span class="identifier">value_type</span></code>
      of the downstream queue (<code class="computeroutput"><span class="keyword">float</span></code>).
      To overcome this limitation, the application must provide a hint:
    </p>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="../images/important.png"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>
        If a callable is to be form an n-to-m transformation using bind and the input
        and output types are different, the type of the return value of the callable
        must match the output type.
      </p></td></tr>
</table></div>
<p>
      Which means, in the example above, <code class="computeroutput"><span class="identifier">sqrt_if_greater</span></code>
      must return <code class="computeroutput"><span class="keyword">float</span></code>. If the input
      and output types are the same, the library can get away with it.
    </p>
<p>
      You might wonder how an actual transformation looks like; take a look at the
      <a href="https://github.com/erenon/pipeline/blob/master/example/transformations.cpp" target="_top">example/transformations.cpp</a> file.
    </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2014 Benedek Thaler<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="glossary.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="open_segments.html"><img src="../images/next.png" alt="Next"></a>
</div>
</body>
</html>
